<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product CRUD with JavaScript</title>
    <link rel="stylesheet" href="/bootstrap.css">
    <style>
        .form-box{
            background-color: whitesmoke;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 1px 0px 13px 8px #ccc;
        }
    </style>
    <!--  ============================CRUD======================= -->
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- Product Form -->
        <div class="col-lg-4 col-md-4 col-sm-12 mt-3">
            <div class="form-box">
                <form id="product_form">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name">
                    </div>

                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" class="form-control">
                            <option value="drink">Drink</option>
                            <option value="food">Food</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="price">Price</label>
                        <input type="number" class="form-control" id="price" min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="image_url">Image URL</label>
                        <input type="url" class="form-control" id="image_url">
                    </div>

                    <div class="form-group">
                        <input type="button" class="btn btn-primary float-right" value="Save" id="btn_save">
                        <input type="button" class="btn btn-danger" value="Cancel" id="btn_cancel">
                    </div>
                </form>
            </div>
        </div>

        <!-- Product Table -->
        <div class="col-lg-8 col-md-8 col-sm-12 mt-3">
            <div class="table-responsive">
                <table id="product_table" class="table table-borderless table-striped">
                    <thead>
                    <tr class="bg-primary text-white">
                        <th>#</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Image</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let input_name = document.getElementById("name");
    let input_category = document.getElementById("category");
    let input_price = document.getElementById("price");
    let input_image_url = document.getElementById("image_url");
    let btn_save = document.getElementById("btn_save");
    let btn_cancel = document.getElementById("btn_cancel");
    let product_table = document.querySelector("#product_table tbody");
    let edit_index = null;

    let product_list = JSON.parse(localStorage.getItem("product_list") ?? "[]");
    renderTable() 

    btn_save.addEventListener("click", function () {
        let name = input_name.value.trim();
        let category = input_category.value;
        let price = input_price.value;
        let image_url = input_image_url.value.trim();

        if (!name) {
            Swal.fire({ title: "Field Error", text: "Name cannot be empty!", icon: "error" });
            return;
        }
        if (!price || price <= 0) {
            Swal.fire({ title: "Field Error", text: "Price must be greater than 0!", icon: "error" });
            return;
        }
        if (!image_url) {
            Swal.fire({ title: "Field Error", text: "Image URL cannot be empty!", icon: "error" });
            return;
        }

        if (edit_index !== null) {
            product_list[edit_index] = { name, category, price, image_url };
            edit_index = null;
            btn_save.value = "Save";
        } else {
            product_list.push({ name, category, price, image_url });
        }

        localStorage.setItem("product_list", JSON.stringify(product_list));

        renderTable();
        clearForm();
    });

    function renderTable() {
        product_table.innerHTML = "";
        product_list.forEach((item, index) => {
            let new_tr = document.createElement("tr");
            new_tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${item.name}</td>
                <td>${item.category}</td>
                <td>${item.price}</td>
                <td><img src="${item.image_url}" alt="" width="40px"></td>
                <td>
                    <input onclick="editProduct(${index})" type="button" value="Edit" class="btn btn-sm btn-warning">
                    <input onclick="deleteProduct(${index})" type="button" value="Delete" class="btn btn-sm btn-danger">
                </td>`;
            product_table.appendChild(new_tr);
        });
    }

    function deleteProduct(index) {
        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                product_list.splice(index, 1);
                localStorage.setItem("product_list", JSON.stringify(product_list));
                renderTable();
            }
        });
    }

    function clearForm() {
        input_name.value = "";
        input_category.value = "drink";
        input_price.value = "";
        input_image_url.value = "";
    }

    function editProduct(index) {
    let product = product_list[index];
    input_name.value = product.name;
    input_category.value = product.category;
    input_price.value = product.price;
    input_image_url.value = product.image_url;
    edit_index = index;
    btn_save.value = "Update";
    input_name.focus();
}

    btn_cancel.addEventListener("click", function () {
        Swal.fire({
            title: "Are you sure?",
            text: "Do you want to cancel?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, reset it!"
        }).then((result) => {
            if (result.isConfirmed) {
                clearForm();
            }
        });
    });
</script>
<script src="./sweetalert.js"></script>
</body>
</html>